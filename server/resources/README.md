# Resources

In contrast to _server/api/_ directory, the content of this directory is essentially dynamically
generated resources for the web app. These are also outside of Basic Auth (if it is in use).

## Web manifest

A [web application manifest](https://developer.mozilla.org/en-US/docs/Web/Manifest) is a JSON text
file that provides information about a web application. The most common use for a web application
manifest is to provide information that the browser needs to install a progressive web app (PWA) on
a device, such as the app's name and icon.

We generate this file dynamically from the content that's available through branding.json, which is
editable on the Marketplace Console. It provides marketplace color and app icons. In addition, the
name of the marketplace is fetched through Marketplace SDK.

## Robots.txt

[Robots.txt](https://developer.mozilla.org/en-US/docs/Glossary/Robots.txt) is a file which is
usually placed in the root of any website. It decides whether crawlers are permitted or forbidden
access to the website.

Robots.txt also contains a link to the sitemap, which is the reason why we generate this on the fly.
Essentially, the _server/resources/robots.txt_ contains a URL
_"https://my.marketplace.com/sitemap-index.xml"_, which is transformed to use the correct hostname
from `REACT_APP_MARKETPLACE_ROOT_URL`. This transformation is done by the actual resource-script:
**robotsTxt.js**.

**Note**: on localhost, this file is served from the Dev port on apiServer.js (3500 aka
http://localhost:3500/robots.txt) for debugging purposes.

### Robots.txt on private marketplace

There's a more restrictive version of the robots.txt (robotsPrivateMarketplace.txt), which is used
if access-control.json asset has private mode set active.

**Note**: For private marketplace, the `/s` route is disallowed, and the `/sitemap` route is
explicitly allowed. If you add new routes that start with `/s` at the root (e.g.
`your.marketplace.com/support`), you need to add them to the robotsPrivateMarketplace.txt file. By
default, [Pages content](https://www.sharetribe.com/docs/template/page-builder/) is served from
`/p/*`, which is unaffected.

## Sitemap

A [sitemap](https://developers.google.com/search/docs/crawling-indexing/sitemaps/overview) is a file
where you provide information about the pages, videos, and other files on your site. Search engines
like Google read this file to crawl your site more efficiently.

Since quite a bit of content is dynamically generated by making queries to Marketplace API, the
sitemap needs to be generated too as a response to data fetch. By default, we generate sitemap files
on the fly (inside request), but we have also added a small in-memory cache (ttl = 1 day) to reduce
the load on the client app's server. If the requests start to take too long, you might want to
consider using cronjob instead of this default behavior of generating files on the fly.

If the request header accepts gzip (`Accept-Encoding: gzip`), the file is returned with Gzip
compression.

**Note**: The format of the generated XML is very simple as other tags than `<loc>` are omitted. We
ended up with this solution because Google ignores `<priority>` and `<changefreq>` values. In
addition, Google uses the `<lastmod>` value only if it's consistently and verifiably accurate. This
is hard to detect reliably on the API level as the data entity might have changed, but the page UI
is not.

### Sitemap Index

We serve /sitemap-index.xml from the root. The _robotsTxt.js_ adds a link to the sitemap-index.xml

The sitemap-index.xml contains links to 3 different sub sitemaps:

- sitemap-default.xml
- sitemap-recent-listings.xml
- sitemap-recent-pages.xml

**Note**: sitemap-recent-listings.xml is not served if the private marketplace mode is activated.

### /sitemap-default.xml

This sitemap contains links to public built-in pages of the client app. It also shows
_landing-page_, _terms-of-service_, and _privacy-policy_ pages as they have fixed paths, unlike
other CMS Pages.

Note: you might want to add your own custom built-in pages and some special searches to this
sitemap. E.g. if you have added a category "hats", you could highlight that for search engine bots
by adding `searchHats: { url: '/s?pub_category=hats' }` to variable **defaultPublicPaths** on
sitemap.js.

**Note**: search page is not served if the private marketplace mode is activated.

### /sitemap-recent-listings.xml

The recent listings is the heaviest file to be returned. Marketplace API returns max 10,000 recent
listings, from which the XML syntax is created and the result is compressed.

**Note**: sitemap-recent-listings.xml is not served if the private marketplace mode is activated.

### /sitemap-recent-pages.xml

This contains (CMS) **Pages**, which are shown from path `/p/:pageId`. However, it doesn't contain
_landing-page_, _terms-of-service_, and _privacy-policy_ as those have permanent paths set
separately - i.e. _sitemap-default.xml_ returns those already.
